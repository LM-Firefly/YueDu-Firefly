import{a0 as q,m as W,o as d,d as u,g as t,F as J,N as Z,t as h,c as G,w as P,f as N,K as k,u as n,a1 as D,s as X,x as y,a2 as j,M as $,R as ee,j as w,e as S,y as te,J as se,p as M,a3 as ae,a4 as oe,G as ne,z as re}from"./vendor-fl4hlNse.js";import{d as ce,i as ie,u as le,a as de}from"./el-message-box-S3k27ovW.js";import{_ as H,A as p}from"./index-DwVIKFWd.js";const ue={class:"books-wrapper"},he={class:"wrapper"},pe=["onClick"],ge={class:"cover-img"},me=["src"],fe={class:"info"},ve={class:"name"},_e={class:"sub"},we={class:"author"},Be={key:0,class:"tags"},Ae={key:1,class:"update-info"},Ce={class:"size"},Ie={class:"date"},xe={key:0,class:"intro"},ke={key:1,class:"dur-chapter"},ye={class:"last-chapter"},Se={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(m,{emit:o}){q(s=>({f19573ba:n(A)}));const R=m,E=o,z=s=>E("bookClick",s),B=s=>ie(s)?p.getProxyCoverUrl(s):s,T=s=>{s.target.src=p.getProxyCoverUrl(s.target.src)},A=W(()=>R.isSearch?"space-between":"flex-start");return(s,f)=>{const L=D;return d(),u("div",ue,[t("div",he,[(d(!0),u(J,null,Z(m.books,r=>{var C;return d(),u("div",{class:"book",key:r.bookUrl,onClick:_=>z(r)},[t("div",ge,[(d(),u("img",{class:"cover",src:B(r.coverUrl),key:r.coverUrl,onErrorOnce:T,alt:"",loading:"lazy"},null,40,me))]),t("div",fe,[t("div",ve,h(r.name),1),t("div",_e,[t("div",we,h(r.author),1),m.isSearch?(d(),u("div",Be,[(d(!0),u(J,null,Z((C=r.kind)==null?void 0:C.split(",").slice(0,2),_=>(d(),G(L,{key:_},{default:P(()=>[N(h(_),1)]),_:2},1024))),128))])):k("",!0),m.isSearch?k("",!0):(d(),u("div",Ae,[f[0]||(f[0]=t("div",{class:"dot"},"•",-1)),t("div",Ce,"共"+h(r.totalChapterNum)+"章",1),f[1]||(f[1]=t("div",{class:"dot"},"•",-1)),t("div",Ie,h(n(ce)(r.lastCheckTime)),1)]))]),m.isSearch?(d(),u("div",xe,h(r.intro),1)):k("",!0),m.isSearch?k("",!0):(d(),u("div",ke," 已读："+h(r.durChapterTitle),1)),t("div",ye,"最新："+h(r.latestChapterTitle),1)])],8,pe)}),128))])])}}},Re=H(Se,[["__scopeId","data-v-1139d638"]]),Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",ze={class:"navigation-wrapper"},Te={class:"search-wrapper"},Le={class:"bottom-wrapper"},Me={class:"recent-wrapper"},Pe={class:"reading-recent"},Ne={class:"setting-wrapper"},Ve={class:"setting-item"},be={class:"bottom-icons"},Je={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Ze={class:"bottom-icon"},We=["src"],De={__name:"BookShelf",setup(m){const o=le(),{connectStatus:R,connectType:E,newConnect:z,shelf:B,theme:T}=X(o),A=W(()=>T.value==6),s=y({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),f=y(null),{showLoading:L,closeLoading:r,loadingWrapper:C,isLoading:_}=de(f,"正在获取书籍信息"),v=j([]),g=y(""),I=y(!1);$(()=>{if(!(I.value&&g.value!="")){if(I.value=!1,v.value=[],g.value==""){v.value=B.value;return}v.value=B.value.filter(a=>a.name.includes(g.value)||a.author.includes(g.value))}});const O=()=>{g.value!=""&&(v.value=[],o.clearSearchBooks(),L(),I.value=!0,p.search(g.value,a=>{_&&r();try{o.setSearchBooks(JSON.parse(a)),v.value=o.searchBooks}catch(e){throw w.error("后端数据错误"),e}},()=>{r(),v.value.length==0&&w.info("搜索结果为空")}))},U=()=>{ae.prompt("请输入 IP 和端口 ( 如：127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?:([1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-6][0-5][0-5][0-3][0-5])$/,inputErrorMessage:"url 形式不正确",beforeClose:(a,e,i)=>{if(a==="confirm"){o.setNewConnect(!0),e.confirmButtonLoading=!0,e.confirmButtonText="校验中……";const c=e.inputValue;p.testLeagdoHttpUrlConnection("http://"+c).then(function(l){e.confirmButtonLoading=!1,o.setConnectType("success"),o.setConnectStatus("已连接 "+c),o.clearSearchBooks(),o.setNewConnect(!1),p.setLeagdoHttpUrl("http://"+c),localStorage.setItem("remoteIp",c),b(),i()}).catch(function(l){throw e.confirmButtonLoading=!1,e.confirmButtonText="确定",w.error("访问失败，请检查您输入的 url"),o.setNewConnect(!1),l})}else i()}})},F=oe(),K=async a=>{const{bookUrl:e,name:i,author:c,durChapterIndex:l=0,durChapterPos:x=0}=a;a.durChapterIndex===void 0&&await p.saveBook(a),V(e,i,c,l,x)},V=(a,e,i,c,l)=>{e!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",a),sessionStorage.setItem("bookName",e),sessionStorage.setItem("bookAuthor",i),sessionStorage.setItem("chapterIndex",c),sessionStorage.setItem("chapterPos",l),s.value={name:e,author:i,url:a,chapterIndex:c,chapterPos:l},localStorage.setItem("readingRecent",JSON.stringify(s.value)),F.push({path:"/chapter"}))};ee(()=>{let a=localStorage.getItem("readingRecent");a!=null&&(s.value=JSON.parse(a),typeof s.value.chapterIndex>"u"&&(s.value.chapterIndex=0)),p.testLeagdoHttpUrlConnection().then(Q).then(Y).catch(function(e){throw o.setConnectType("danger"),o.setConnectStatus("连接异常"),w.error("后端连接失败异常，请检查阅读WEB服务或者设置其它可用IP"),o.setNewConnect(!1),e})});const Y=()=>{C(o.saveBookProgress().finally(b))},b=()=>p.getBookShelf().then(a=>{o.setConnectType("success"),a.data.isSuccess?o.addBooks(a.data.data.sort(function(e,i){var c=e.durChapterTime||0,l=i.durChapterTime||0;return l-c})):w.error(a.data.errorMsg??"后端返回格式错误！"),o.setConnectStatus("已连接 "+p.legado_http_origin),o.setNewConnect(!1)}),Q=()=>p.getReadConfig().then(a=>{var e=a.data.data;if(e){let i=JSON.parse(e);o.setConfig(i)}});return(a,e)=>{const i=ne,c=D,l=Re;return d(),u("div",{class:M({"index-wrapper":!0,night:n(A),day:!n(A)})},[t("div",ze,[e[4]||(e[4]=t("div",{class:"navigation-title-wrapper"},[t("div",{class:"navigation-title"},"阅读"),t("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),t("div",Te,[S(i,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:n(g),"onUpdate:modelValue":e[0]||(e[0]=x=>te(g)?g.value=x:null),class:"search-input","prefix-icon":n(re),onKeyup:se(O,["enter"])},null,8,["modelValue","prefix-icon"])]),t("div",Le,[t("div",Me,[e[2]||(e[2]=t("div",{class:"recent-title"},"最近阅读",-1)),t("div",Pe,[S(c,{type:n(s).name=="尚无阅读记录"?"warning":"",class:M(["recent-book",{"no-point":n(s).url==""}]),size:"large",onClick:e[1]||(e[1]=x=>V(n(s).url,n(s).name,n(s).author,n(s).chapterIndex,n(s).chapterPos))},{default:P(()=>[N(h(n(s).name),1)]),_:1},8,["type","class"])])]),t("div",Ne,[e[3]||(e[3]=t("div",{class:"setting-title"},"基本设定",-1)),t("div",Ve,[S(c,{type:n(E),size:"large",class:M(["setting-connect",{"no-point":n(z)}]),onClick:U},{default:P(()=>[N(h(n(R)),1)]),_:1},8,["type","class"])])])]),t("div",be,[t("a",Je,[t("div",Ze,[t("img",{src:n(Ee),alt:""},null,8,We)])])])]),t("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:f},[S(l,{books:n(v),onBookClick:K,isSearch:n(I)},null,8,["books","isSearch"])],512)],2)}}},Fe=H(De,[["__scopeId","data-v-8c72c6cb"]]);export{Fe as default};
